<!DOCTYPE html>
<!--
    School Escape - Action Arcade Game
    Copyright (c) 2025 Ilja Livenson and Mark Livenson
    All rights reserved.
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>School Escape - Action Arcade Game</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div id="game-container">
        <div id="game-header">
            <div id="score-display">Score: 0</div>
            <div id="combo-display">Combo: x1</div>
            <div id="level-display">Level 1</div>
            <div id="items-display">Items: 0/0</div>
            <div id="powerup-display">
                <div class="powerup-slot" id="powerup-1" title="Hall Pass"></div>
                <div class="powerup-slot" id="powerup-2" title="Energy Drink"></div>
                <div class="powerup-slot" id="powerup-3" title="Stink Bomb"></div>
            </div>
            <div id="lives-display"></div>
        </div>

        <canvas id="game-canvas" width="800" height="600"></canvas>
        <canvas id="minimap" width="150" height="112"></canvas>

        <!-- Multiplayer Players HUD -->
        <div id="multiplayer-players-hud"></div>

        <div id="game-footer">
            <div class="key-hint"><span class="key">WASD</span> or <span class="key">Arrows</span> Move</div>
            <div class="key-hint"><span class="key">SPACE</span> Dash</div>
            <div class="key-hint"><span class="key">1-3</span> Use Power-up</div>
            <div class="key-hint"><span class="key">ESC</span> Pause</div>
        </div>

        <!-- Main Menu -->
        <div id="main-menu" class="menu-screen">
            <h1>SCHOOL ESCAPE</h1>
            <h2>Escape the Teachers!</h2>

            <!-- Game Mode Selection -->
            <div style="display: flex; gap: 20px; margin: 20px 0; flex-wrap: wrap; justify-content: center;">
                <button class="menu-button" id="campaign-button" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">üìö CAMPAIGN</button>
                <button class="menu-button" id="freeplay-button" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">üéÆ FREE PLAY</button>
                <button class="menu-button" id="multiplayer-button" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">üë• MULTIPLAYER</button>
            </div>

            <!-- Campaign Progress Display -->
            <div id="campaign-progress-display" class="settings-panel" style="display: none; text-align: center;">
                <div style="color: #ffd700; font-size: 18px; margin-bottom: 10px;" id="current-level-text">Current Level: Grade 1</div>
                <div style="width: 100%; height: 15px; background: rgba(255,255,255,0.2); border-radius: 8px; overflow: hidden;">
                    <div id="menu-progress-bar" style="height: 100%; background: linear-gradient(90deg, #4ade80, #22d3ee); width: 0%; transition: width 0.3s;"></div>
                </div>
                <div style="color: #aaa; margin-top: 5px;" id="menu-progress-text">0/17 completed</div>
            </div>

            <button class="menu-button" id="start-button" style="display: none;">START GAME</button>

            <!-- Free Play Settings (Collapsible) -->
            <div id="freeplay-settings" class="settings-panel" style="display: none; padding: 10px;">
                <div class="collapsible-header expanded" id="freeplay-toggle" onclick="toggleFreeplayPanel()">
                    <span class="header-title" data-translate="freeplaySettings">üéÆ Free Play Settings</span>
                    <span class="toggle-icon">‚ñº</span>
                </div>
                <div class="collapsible-content expanded" id="freeplay-content">
                    <div class="setting-row">
                        <label data-translate="schoolType">School Type:</label>
                        <select id="school-type">
                            <option value="elementary">Elementary (Easy)</option>
                            <option value="middle" selected>Middle School (Medium)</option>
                            <option value="high">High School (Hard)</option>
                            <option value="university">University (Expert)</option>
                        </select>
                    </div>
                    <div class="setting-row">
                        <label data-translate="mapSize">Map Size:</label>
                        <select id="map-size">
                            <option value="small">Small</option>
                            <option value="medium" selected>Medium</option>
                            <option value="large">Large</option>
                        </select>
                    </div>
                    <div class="setting-row">
                        <label data-translate="teachers">Teachers:</label>
                        <input type="range" id="teacher-count" min="2" max="8" value="4">
                        <span id="teacher-count-display">4</span>
                    </div>
                </div>
            </div>

            <!-- Common Settings (Collapsible) -->
            <div class="settings-panel" style="padding: 10px;">
                <div class="collapsible-header" id="settings-toggle" onclick="toggleSettingsPanel()">
                    <span class="header-title">‚öôÔ∏è Settings</span>
                    <span class="toggle-icon">‚ñº</span>
                </div>
                <div class="collapsible-content" id="settings-content">
                    <div class="setting-row">
                        <label data-translate="language">Language:</label>
                        <select id="language-select" onchange="setLanguage(this.value)">
                            <option value="en">English</option>
                            <option value="et">Eesti</option>
                            <option value="lv">Latvie≈°u</option>
                            <option value="lt">Lietuvi≈≥</option>
                            <option value="ru">–†—É—Å—Å–∫–∏–π</option>
                        </select>
                    </div>
                    <div class="setting-row">
                        <label data-translate="avatarLabel">Avatar:</label>
                        <select id="avatar-select" onchange="setAvatar(this.value)">
                            <option value="default" data-translate="avatarDefault">Default Student</option>
                            <option value="nerd" data-translate="avatarNerd">Nerd</option>
                            <option value="jock" data-translate="avatarJock">Jock</option>
                            <option value="goth" data-translate="avatarGoth">Goth</option>
                            <option value="artist" data-translate="avatarArtist">Artist</option>
                            <option value="skater" data-translate="avatarSkater">Skater</option>
                            <option value="preppy" data-translate="avatarPreppy">Preppy</option>
                            <option value="punk" data-translate="avatarPunk">Punk</option>
                        </select>
                    </div>
                    <div class="setting-row" style="justify-content: center;">
                        <canvas id="avatar-preview" width="80" height="80" style="border: 2px solid #4b5563; border-radius: 8px; background: #374151;"></canvas>
                    </div>
                    <div class="setting-row" style="justify-content: center; gap: 20px;">
                        <button class="sound-btn" id="sound-toggle" onclick="toggleSound()">üîä Sound: ON</button>
                    </div>
                    <div class="setting-row" style="justify-content: center;">
                        <button class="sound-btn" id="events-toggle" onclick="toggleEvents()" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">üé≤ Random Events: OFF</button>
                    </div>
                </div>
            </div>

            <!-- Map Configuration (Collapsible) -->
            <div class="settings-panel" style="padding: 10px;">
                <div class="collapsible-header" id="map-config-toggle" onclick="toggleMapConfigPanel()">
                    <span class="header-title" data-translate="mapConfigTitle">üó∫Ô∏è Map Configuration</span>
                    <span class="toggle-icon">‚ñº</span>
                </div>
                <div class="collapsible-content" id="map-config-content">
                    <div class="setting-row">
                        <label data-translate="mapTopology">Map Layout:</label>
                        <select id="map-topology">
                            <option value="grid" data-translate="topologyGrid">Grid (Classic)</option>
                            <option value="labyrinth" data-translate="topologyLabyrinth">Labyrinth (Maze)</option>
                            <option value="openPlan" data-translate="topologyOpenPlan">Open Plan</option>
                        </select>
                    </div>
                    <div class="setting-row">
                        <label data-translate="corridorDensity">Corridor Density:</label>
                        <select id="corridor-density">
                            <option value="low" data-translate="densityLow">Low</option>
                            <option value="medium" selected data-translate="densityMedium">Medium</option>
                            <option value="high" data-translate="densityHigh">High</option>
                        </select>
                    </div>
                    <div class="setting-row">
                        <label data-translate="roomDensity">Room Density:</label>
                        <select id="room-density">
                            <option value="few" data-translate="roomsFew">Few Rooms</option>
                            <option value="normal" selected data-translate="roomsNormal">Normal</option>
                            <option value="many" data-translate="roomsMany">Many Rooms</option>
                        </select>
                    </div>
                </div>
            </div>

            <div style="margin-top: 30px; color: #666; font-size: 12px;">
                ¬© 2025 Ilja Livenson and Mark Livenson
            </div>
        </div>

        <!-- Help Button (Fixed Position) -->
        <button class="help-button" id="how-to-play-button" title="How to Play">?</button>

        <!-- How To Play -->
        <div id="how-to-play-screen" class="menu-screen hidden">
            <h2 style="color: #ffd700; margin-bottom: 30px;">HOW TO PLAY</h2>
            <div class="settings-panel" style="max-width: 500px; text-align: left;">
                <p style="margin-bottom: 15px;"><strong style="color: #4ade80;">OBJECTIVE:</strong> Collect all pizza slices and reach the exit without getting caught by teachers!</p>

                <p style="margin-bottom: 15px;"><strong style="color: #60a5fa;">CONTROLS (Keyboard):</strong></p>
                <ul style="margin-left: 20px; margin-bottom: 15px;">
                    <li>WASD or Arrow Keys - Move</li>
                    <li>SPACE - Dash (quick burst of speed)</li>
                    <li>1, 2, 3 - Use collected power-ups</li>
                    <li>ESC - Pause game</li>
                </ul>

                <p style="margin-bottom: 15px;"><strong style="color: #60a5fa;">CONTROLS (Mobile/Touch):</strong></p>
                <ul style="margin-left: 20px; margin-bottom: 15px;">
                    <li>Left joystick - Move in any direction</li>
                    <li>Dash button - Quick burst of speed</li>
                    <li>Power-up button - Use collected power-up</li>
                    <li>Pause button (top) - Pause game</li>
                </ul>

                <p style="margin-bottom: 15px;"><strong style="color: #ffd700;">POWER-UPS:</strong></p>
                <ul style="margin-left: 20px; margin-bottom: 15px;">
                    <li>üìú Hall Pass - Temporary invincibility</li>
                    <li>‚ö° Energy Drink - Super speed</li>
                    <li>üí® Stink Bomb - Stuns nearby teachers</li>
                    <li>üõπ Skateboard - Fast movement</li>
                </ul>

                <p style="margin-bottom: 15px;"><strong style="color: #ff6b6b;">TEACHERS:</strong></p>
                <ul style="margin-left: 20px; margin-bottom: 15px;">
                    <li>üßë‚Äçüè´ Patrol Teacher - Follows set routes</li>
                    <li>üë®‚Äçüè´ Hunter Teacher - Actively chases you</li>
                    <li>üë©‚Äçüè´ Fast Teacher - Quick but predictable</li>
                </ul>

                <p style="margin-bottom: 15px;"><strong style="color: #9ca3af;">MAP TILES:</strong></p>
                <ul style="margin-left: 20px;">
                    <li><span style="display: inline-block; width: 16px; height: 16px; background: #4a4a6a; vertical-align: middle; margin-right: 5px; border-radius: 2px;"></span> Floor - Walkable area</li>
                    <li><span style="display: inline-block; width: 16px; height: 16px; background: linear-gradient(#5c4033, #3d2817); vertical-align: middle; margin-right: 5px; border-radius: 2px;"></span> Wall - Cannot pass through</li>
                    <li><span style="display: inline-block; width: 16px; height: 16px; background: #8b4513; vertical-align: middle; margin-right: 5px; border-radius: 2px;"></span> Desk - Classroom obstacle</li>
                    <li><span style="display: inline-block; width: 16px; height: 16px; background: #4a90a4; vertical-align: middle; margin-right: 5px; border-radius: 2px;"></span> Locker - Corridor obstacle</li>
                    <li><span style="display: inline-block; width: 16px; height: 16px; background: rgba(100, 200, 255, 0.5); vertical-align: middle; margin-right: 5px; border-radius: 2px;"></span> Wet Floor - Slippery surface</li>
                    <li><span style="display: inline-block; width: 16px; height: 16px; background: #4ade80; vertical-align: middle; margin-right: 5px; border-radius: 2px;"></span> Exit - Escape here (green when unlocked)</li>
                </ul>
            </div>
            <button class="menu-button" id="back-to-menu-button">BACK TO MENU</button>
        </div>

        <!-- Pause Screen -->
        <div id="pause-screen" class="menu-screen hidden">
            <h2>PAUSED</h2>
            <button class="menu-button" id="resume-button">RESUME</button>
            <button class="menu-button" id="quit-button">QUIT TO MENU</button>
        </div>

        <!-- Game Over Screen -->
        <div id="game-over-screen" class="menu-screen hidden">
            <h2>GAME OVER</h2>
            <div id="final-score">Score: 0</div>
            <div id="final-stats" style="margin-bottom: 20px; color: #aaa;"></div>
            <div id="multiplayer-scores" style="display: none; margin: 20px 0; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 10px; max-width: 300px;">
                <div style="font-size: 14px; color: #f59e0b; margin-bottom: 10px; font-weight: bold;">PLAYER SCORES</div>
                <div id="multiplayer-scores-list"></div>
            </div>
            <button class="menu-button" id="retry-button">PLAY AGAIN</button>
            <button class="menu-button" id="menu-button">MAIN MENU</button>
        </div>

        <!-- Level Complete Screen -->
        <div id="level-complete-screen" class="menu-screen hidden">
            <h2 id="level-complete-title" style="color: #4ade80;">LEVEL COMPLETE!</h2>
            <div id="level-name-display" style="font-size: 28px; color: #ffd700; margin: 10px 0;"></div>
            <div id="level-score" style="font-size: 24px; color: #fff; margin: 10px 0;">Score: 0</div>
            <div id="level-multiplayer-scores" style="display: none; margin: 20px 0; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 10px; max-width: 300px;">
                <div style="font-size: 14px; color: #f59e0b; margin-bottom: 10px; font-weight: bold;">PLAYER SCORES</div>
                <div id="level-multiplayer-scores-list"></div>
            </div>
            <div id="level-progress" style="margin: 20px 0;">
                <div style="color: #aaa; margin-bottom: 10px;">Progress</div>
                <div id="progress-bar-container" style="width: 300px; height: 20px; background: rgba(255,255,255,0.2); border-radius: 10px; overflow: hidden; margin: 0 auto;">
                    <div id="progress-bar" style="height: 100%; background: linear-gradient(90deg, #4ade80, #22d3ee); width: 0%; transition: width 0.5s;"></div>
                </div>
                <div id="progress-text" style="color: #aaa; margin-top: 5px;">1/17</div>
            </div>
            <button class="menu-button" id="next-level-button">NEXT LEVEL</button>
            <button class="menu-button" id="level-menu-button" style="background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);">MAIN MENU</button>
        </div>

        <!-- Graduation Screen -->
        <div id="graduation-screen" class="menu-screen hidden">
            <h2 style="color: #ffd700; font-size: 48px;">üéì GRADUATED! üéì</h2>
            <div id="graduation-message" style="font-size: 20px; color: #fff; margin: 20px 0; max-width: 400px;"></div>
            <div id="total-score" style="font-size: 32px; color: #4ade80; margin: 20px 0;">Total Score: 0</div>
            <button class="menu-button" id="new-game-button">NEW GAME</button>
            <button class="menu-button" id="graduation-menu-button" style="background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);">MAIN MENU</button>
        </div>

        <!-- Multiplayer Menu Screen -->
        <div id="multiplayer-menu-screen" class="menu-screen hidden">
            <h2 style="color: #f59e0b;">üë• MULTIPLAYER</h2>
            <p style="color: #aaa; margin-bottom: 20px;" data-translate="multiplayerDesc">Play with friends online!</p>

            <div style="display: flex; gap: 20px; margin: 20px 0;">
                <button class="menu-button" id="create-room-button" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                    üè† CREATE ROOM
                </button>
                <button class="menu-button" id="join-room-button" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);">
                    üö™ JOIN ROOM
                </button>
            </div>

            <button class="menu-button" id="mp-back-to-menu" style="background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);">BACK</button>
        </div>

        <!-- Create Room Screen -->
        <div id="create-room-screen" class="menu-screen hidden">
            <h2 style="color: #10b981;">üè† CREATE ROOM</h2>

            <div class="settings-panel" style="text-align: center;">
                <p style="color: #aaa; margin-bottom: 10px;">Your Room Code:</p>
                <div class="room-code-display" id="host-room-code">----</div>
                <p style="color: #888; font-size: 12px;">Share this code with your friends</p>
            </div>

            <div id="mp-connection-status" class="multiplayer-status">Connecting...</div>

            <div class="player-list" id="host-player-list">
                <p style="color: #aaa; text-align: center;">Waiting for players...</p>
            </div>

            <!-- Game Settings for Host -->
            <div class="settings-panel" style="padding: 10px;">
                <div class="setting-row">
                    <label>Map Size:</label>
                    <select id="mp-map-size">
                        <option value="small">Small</option>
                        <option value="medium" selected>Medium</option>
                        <option value="large">Large</option>
                    </select>
                </div>
                <div class="setting-row">
                    <label>Teachers:</label>
                    <input type="range" id="mp-teacher-count" min="2" max="8" value="4">
                    <span id="mp-teacher-count-display">4</span>
                </div>
            </div>

            <div style="display: flex; gap: 15px; margin-top: 15px;">
                <button class="menu-button" id="mp-start-game" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                    ‚ñ∂ START GAME
                </button>
                <button class="menu-button" id="mp-cancel-host" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                    ‚úï CANCEL
                </button>
            </div>
        </div>

        <!-- Join Room Screen -->
        <div id="join-room-screen" class="menu-screen hidden">
            <h2 style="color: #3b82f6;">üö™ JOIN ROOM</h2>

            <div class="settings-panel" style="text-align: center;">
                <p style="color: #aaa; margin-bottom: 15px;">Enter Room Code:</p>
                <input type="text" class="room-code-input" id="join-room-code" maxlength="3" placeholder="XXX" autocomplete="off">
            </div>

            <div id="join-connection-status" class="multiplayer-status"></div>

            <div style="display: flex; gap: 15px; margin-top: 15px;">
                <button class="menu-button" id="mp-join-room" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);">
                    üö™ JOIN
                </button>
                <button class="menu-button" id="mp-cancel-join" style="background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);">
                    BACK
                </button>
            </div>
        </div>

        <!-- Multiplayer Lobby Screen (for non-host after joining) -->
        <div id="multiplayer-lobby-screen" class="menu-screen hidden">
            <h2 style="color: #f59e0b;">üë• GAME LOBBY</h2>

            <div class="settings-panel" style="text-align: center;">
                <p style="color: #aaa; margin-bottom: 10px;">Room Code:</p>
                <div class="room-code-display" id="lobby-room-code">----</div>
            </div>

            <div class="player-list" id="lobby-player-list">
                <p style="color: #aaa; text-align: center;">Loading players...</p>
            </div>

            <p style="color: #aaa; margin: 15px 0;">Waiting for host to start the game...</p>

            <button class="menu-button" id="mp-leave-lobby" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                ‚úï LEAVE
            </button>
        </div>

        <!-- Message Popup -->
        <div id="message-popup"></div>

        <!-- Mobile Controls -->
        <div id="mobile-controls" class="mobile-controls hidden">
            <!-- Virtual Joystick (left side) -->
            <div id="joystick-container" class="joystick-container">
                <div id="joystick-base" class="joystick-base">
                    <div id="joystick-knob" class="joystick-knob"></div>
                </div>
            </div>

            <!-- Action Buttons (right side) -->
            <div id="action-buttons" class="action-buttons">
                <button id="mobile-dash-btn" class="mobile-action-btn dash-btn">
                    <span class="btn-icon">‚ö°</span>
                    <span class="btn-label">DASH</span>
                </button>
                <button id="mobile-powerup-btn" class="mobile-action-btn powerup-btn">
                    <span class="btn-icon" id="mobile-powerup-icon">üéí</span>
                    <span class="btn-label">POWER-UP</span>
                </button>
            </div>

            <!-- Pause Button (top right corner) -->
            <button id="mobile-pause-btn" class="mobile-pause-btn">‚è∏Ô∏è</button>
        </div>
    </div>

    <!-- JavaScript Modules -->
    <script src="js/game.js"></script>
    <script src="js/translations.js"></script>
    <script src="js/audio.js"></script>
    <script src="js/multiplayer.js"></script>
    <script src="js/map.js"></script>
    <script src="js/ui.js"></script>
</body>
</html>
